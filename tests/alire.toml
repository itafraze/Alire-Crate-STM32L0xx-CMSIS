name = "tests"
description = "Tests project for library stm32l0xx_cmsis"
version = "0.0.0-dev"

authors = ["Emanuele Zarfati"]
maintainers = ["Emanuele Zarfati <zarfati.tecno@gmail.com>"]
maintainers-logins = ["ezetec"]

[[depends-on]]
gnat_arm_elf = "^13.2.1"
stm32l0xx_cmsis = "*"
aunit = "^24.0.0"

[[pins]]
stm32l0xx_cmsis = { path='..' }

[build-switches.release]
optimization    = "size"       # "-Os", "-gnatn", "-ffunction-sections", "-fdata-sections"
debug_info      = "no"         #
runtime_checks  = "none"       # "-gnatp"
compile_checks  = "none"       #
contracts       = "no"         #
style_checks    = "yes"        # "-gnaty3", "-gnatya", "-gnatyA", "-gnatyB", "-gnatyb", "-gnatyc", "-gnaty-d", "-gnatye", "-gnatyf", "-gnatyh", "-gnatyi", "-gnatyI", "-gnatyk", "-gnatyl", "-gnatym", "-gnatyn", "-gnatyO", "-gnatyp", "-gnatyr", "-gnatyS", "-gnatyt", "-gnatyu", "-gnatyx"

[build-switches.validation]
optimization    = "size"       # "-Os", "-gnatn", "-ffunction-sections", "-fdata-sections"
debug_info      = "no"         #
runtime_checks  = "everything" # "-gnato"
compile_checks  = "errors"     # "-gnatwa", "-gnatw.X", "-gnatVa", "-gnatwe"
contracts       = "yes"        # "-gnata"
style_checks    = "yes"        # "-gnaty3", "-gnatya", "-gnatyA", "-gnatyB", "-gnatyb", "-gnatyc", "-gnaty-d", "-gnatye", "-gnatyf", "-gnatyh", "-gnatyi", "-gnatyI", "-gnatyk", "-gnatyl", "-gnatym", "-gnatyn", "-gnatyO", "-gnatyp", "-gnatyr", "-gnatyS", "-gnatyt", "-gnatyu", "-gnatyx"

[build-switches.development]
optimization    = "debug"      # "-Os", "-gnatn", "-ffunction-sections", "-fdata-sections"
debug_info      = "yes"        # "-g"
runtime_checks  = "default"    #
compile_checks  = "warnings"   # "-gnatwa", "-gnatw.X", "-gnatVa"
contracts       = "yes"        # "-gnata"
style_checks    = "no"         #

[build-profiles]
stm32l0xx_cmsis = "validation"

[configuration.values]
stm32l0xx_cmsis.Device = "stm32l011d4"
stm32l0xx_cmsis.With_Startup = false

[gpr-externals]
EMU_MODE = ["run", "debug"]

[gpr-set-externals]
AUNIT_RUNTIME = "zfp-cross"
AUNIT_BUILD_MODE = "Install"

[[actions]]
type = "post-build"
command = ["sh", "-c", "arm-eabi-objdump -DxS bin/tests.elf | tee bin/tests.dis >/dev/null"]

[[actions]]
type = "post-build"
command = ["sh", "-c", "arm-eabi-objcopy -O binary -R .eeprom bin/tests.elf bin/tests-noeeprom.bin"]

[[actions]]
type = "post-build"
command = ["sh", "-c", "arm-eabi-objcopy -O binary -j .eeprom bin/tests.elf bin/tests-eeprom.bin"]

[[actions]]
type = "post-build"
command = ["sh", "-c", "hexdump -C bin/tests-noeeprom.bin | tee bin/tests-noeeprom.hexdump >/dev/null"]

[[actions]]
type = "post-build"
command = ["sh", "-c", "hexdump -C bin/tests-eeprom.bin | tee bin/tests-eeprom.hexdump >/dev/null"]
